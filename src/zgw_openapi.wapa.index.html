<%@page language="abap"%>                                                                                                                                                                                                                                      
<%@extension name="htmlb" prefix="htmlb"%>                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
<!DOCTYPE html>                                                                                                                                                                                                                                                
<html>                                                                                                                                                                                                                                                         
<head>                                                                                                                                                                                                                                                         
  <link rel="icon" type="image/png" href="./favicon-32x32.png" sizes="32x32" />                                                                                                                                                                                
  <link rel="icon" type="image/png" href="./favicon-16x16.png" sizes="16x16" />                                                                                                                                                                                
  <link rel="stylesheet" type="text/css" href="swagger-ui.css" >                                                                                                                                                                                               
  <style>                                                                                                                                                                                                                                                      
    html                                                                                                                                                                                                                                                       
    {                                                                                                                                                                                                                                                          
      box-sizing: border-box;                                                                                                                                                                                                                                  
      overflow: -moz-scrollbars-vertical;                                                                                                                                                                                                                      
      overflow-y: scroll;                                                                                                                                                                                                                                      
    }                                                                                                                                                                                                                                                          
    *,                                                                                                                                                                                                                                                         
    *:before,                                                                                                                                                                                                                                                  
    *:after                                                                                                                                                                                                                                                    
    {                                                                                                                                                                                                                                                          
      box-sizing: inherit;                                                                                                                                                                                                                                     
    }                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
    body {                                                                                                                                                                                                                                                     
      margin:0;                                                                                                                                                                                                                                                
      background: #fafafa;                                                                                                                                                                                                                                     
    }                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
    .url {                                                                                                                                                                                                                                                     
      visibility: hidden;                                                                                                                                                                                                                                      
    }                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
  </style>                                                                                                                                                                                                                                                     
</head>                                                                                                                                                                                                                                                        
<body>                                                                                                                                                                                                                                                         
    <div id="swagger-ui"></div>                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
    <script src="swagger-ui-bundle.js"></script>                                                                                                                                                                                                               
    <script src="swagger-ui-standalone-preset.js"></script>                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
    <script>                                                                                                                                                                                                                                                   
        window.onload = function() {                                                                                                                                                                                                                           
          // Begin Swagger UI call region                                                                                                                                                                                                                      
          const ui = SwaggerUIBundle({                                                                                                                                                                                                                         
            url: "<%= json_url %>",                                                                                                                                                                                                                            
            dom_id: '#swagger-ui',                                                                                                                                                                                                                             
            deepLinking: true,                                                                                                                                                                                                                                 
            presets: [                                                                                                                                                                                                                                         
              SwaggerUIBundle.presets.apis,                                                                                                                                                                                                                    
              //SwaggerUIStandalonePreset                                                                                                                                                                                                                      
            ],                                                                                                                                                                                                                                                 
            plugins: [                                                                                                                                                                                                                                         
              //SwaggerUIBundle.plugins.DownloadUrl                                                                                                                                                                                                            
            ],                                                                                                                                                                                                                                                 
            //layout: "StandaloneLayout",                                                                                                                                                                                                                      
            requestInterceptor: function(req) {                                                                                                                                                                                                                
              debugger;                                                                                                                                                                                                                                        
              //Skip CSRF interception when loading OpenUI JSON specification                                                                                                                                                                                  
              if( req.loadSpec === true || req.method === "GET" ){                                                                                                                                                                                             
                return req;                                                                                                                                                                                                                                    
              }                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
              //Get etag for PATCH, PUT and DELETE requests                                                                                                                                                                                                    
              if( req.method === "PATCH" || req.method === "PUT" || req.method === "DELETE" ){                                                                                                                                                                 
                //Intercept request and perform a GET request for the entity to receive etag information (synchonous request)                                                                                                                                  
                var etagRequest = new XMLHttpRequest();                                                                                                                                                                                                        
                etagRequest.open('GET', req.url, false);                                                                                                                                                                                                       
                etagRequest.send(null);                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                //Check request status 200 (success) or 501 (not implemented)                                                                                                                                                                                  
                if (etagRequest.status === 200 || etagRequest.status === 501 ) {                                                                                                                                                                               
                  var etag = etagRequest.getResponseHeader('etag');                                                                                                                                                                                            
                  if( etag !== undefined ){                                                                                                                                                                                                                    
                    req.headers['If-Match'] = etag;                                                                                                                                                                                                            
                  }                                                                                                                                                                                                                                            
                }                                                                                                                                                                                                                                              
              }                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
              //Read selected server from HTML document                                                                                                                                                                                                        
              var serverDropDown = document.getElementsByClassName('servers')[0].childNodes[0].childNodes[0];                                                                                                                                                  
              var server = serverDropDown.selectedOptions[0].text;                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
              //Intercept request and request a CSRF-token from SAP Gateway (synchonous request)                                                                                                                                                               
              var request = new XMLHttpRequest();                                                                                                                                                                                                              
              request.open('GET', server, false);                                                                                                                                                                                                              
              request.setRequestHeader("X-CSRF-Token", "Fetch");                                                                                                                                                                                               
              request.send(null);                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
              //Check request status 200 (success) or 501 (not implemented)                                                                                                                                                                                    
              if (request.status === 200 || request.status === 501 ) {                                                                                                                                                                                         
                var csrf = request.getResponseHeader('X-CSRF-Token');                                                                                                                                                                                          
                req.headers['X-CSRF-TOKEN'] = csrf;                                                                                                                                                                                                            
              }                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
              //Return request                                                                                                                                                                                                                                 
              return req;                                                                                                                                                                                                                                      
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
          });                                                                                                                                                                                                                                                  
          // End Swagger UI call region                                                                                                                                                                                                                        
          window.ui = ui;                                                                                                                                                                                                                                      
        }                                                                                                                                                                                                                                                      
      </script>                                                                                                                                                                                                                                                
</body>                                                                                                                                                                                                                                                        
</html>                                                                                                                                                                                                                                                        